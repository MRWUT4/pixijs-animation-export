(function(window){window.aape=window.aape||{};window.aape.MovieClip=MovieClip;var prototype=MovieClip.prototype=Object.create(PIXI.extras.AnimatedSprite.prototype);prototype.constructor=MovieClip;MovieClip.ANIMATION_SPEED=1;function MovieClip(textures,animations,comments){PIXI.extras.AnimatedSprite.call(this,textures,animations);this.animationDictionary=animations||{};this.comments=comments||null;this.onAnimationComplete=null;this.isPlaying=true;this.setAnimation(0)}Object.defineProperty(prototype,"stage",{get:function(){return this.parent}});Object.defineProperty(prototype,"totalAnimationFrames",{get:function(){return this.endFrame-1-this.beginFrame}});Object.defineProperty(prototype,"labels",{get:function(){if(!this._labels){this._labels=[];for(var property in this.animationDictionary)this.labels.push(property)}return this._labels}});Object.defineProperty(prototype,"currentLabel",{get:function(){return this.getLabelAtFrame(this.beginFrame)}});Object.defineProperty(prototype,"currentFrameIndexLabel",{get:function(){return this.getLabelAtFrame(this.currentFrameIndex)}});Object.defineProperty(prototype,"currentLabelObject",{get:function(){return this.animationDictionary[this.getLabelAtFrame(this.beginFrame)]}});Object.defineProperty(prototype,"currentFrameIndex",{get:function(){var begin=this.currentLabelObject?this.currentLabelObject.begin:0;return Math.floor(begin+this._currentTime)}});prototype.getFrameNumber=function(label,frameNumber){return typeof label=="number"?label:frameNumber||0};prototype.getLabelAtFrame=function(frame){for(var property in this.animationDictionary){var value=this.animationDictionary[property];if(frame>=value.begin&&frame<=value.end)return property}};prototype.gotoAndPlayMovieClip=prototype.gotoAndPlay;prototype.gotoAndPlay=function(label,frameNumber,loop){frameNumber=this.getFrameNumber(label,frameNumber);this._currentTime=frameNumber;this.setAnimation(label,loop);this.gotoAndPlayMovieClip(frameNumber)};prototype.gotoAndStopMovieClip=prototype.gotoAndStop;prototype.gotoAndStop=function(label,frameNumber){frameNumber=this.getFrameNumber(label,frameNumber);this.stop();this.setAnimation(label);this.isPlaying=false;this.setFrame(frameNumber)};prototype.setFrame=function(frameNumber){this._currentTime=frameNumber;var round=Math.floor(this._currentTime);this._texture=this._textures[this.getAnimationFrameIndex(round)%this._textures.length]};prototype.update=function(deltaTime){this._currentTime+=this.animationSpeed*deltaTime*MovieClip.ANIMATION_SPEED;var floor=Math.floor(this._currentTime);var index=null;if(floor<0){if(this.loop){var frameIndex=this.getAnimationFrameIndex((this._textures.length-1+floor)%this._textures.length);this._texture=this._textures[frameIndex]}else{if(this.onComplete)this.onComplete(this)}}else if(this.loop||floor<this.endFrame-this.beginFrame){index=this.getAnimationFrameIndex(floor)%this._textures.length;this._texture=this._textures[index];if(this.onAnimationComplete&&index==this.endFrame-1)this.onAnimationComplete(this)}else if(floor>=this.endFrame){if(this.onComplete)this.onComplete(this)}};prototype.clone=function(){var clone=new aape.MovieClip(this.textures,this.animationDictionary);clone.pivot={x:this.pivot.x,y:this.pivot.y};clone.scale={x:this.scale.x,y:this.scale.y};clone.rotation=this.rotation;clone.x=this.x;clone.y=this.y;return clone};prototype.setAnimation=function(label,loop){this.animation=this.animationDictionary[label];if(this.animation)this.animation.loop=loop!==undefined?true:loop;this.beginFrame=this.animation?this.animation.begin:0;this.endFrame=this.animation?this.animation.end+1:this.textures.length};prototype.getAnimationFrameIndex=function(index){var frameIndex=this.beginFrame;frameIndex+=index%(this.endFrame-this.beginFrame);return frameIndex}})(window);(function(window){window.aape=window.aape||{};window.aape.Sprite=Sprite;var prototype=Sprite.prototype=Object.create(PIXI.Sprite.prototype);prototype.constructor=Sprite;function Sprite(texture){PIXI.Sprite.call(this,texture)}prototype.clone=function(deepCopy){deepCopy=deepCopy!==undefined?deepCopy:false;var clone=null;if(deepCopy){var baseTexture=this.texture.baseTexture;var frame=this.texture.frame.clone();var crop=this.texture.crop.clone();var trim=this.texture.trim.clone();var texture=new PIXI.Texture(baseTexture,frame,crop,trim);clone=new aape.Sprite(texture)}else clone=new aape.Sprite(this.texture);return clone};Object.defineProperty(prototype,"stage",{get:function(){if(!this._stage){var parent=this.parent;while(parent!=null){parent=parent.parent;if(parent)this._stage=parent}}return this._stage}});Object.defineProperty(prototype,"renderer",{get:function(){return this.stage.renderer}})})(window);(function(window){window.aape=window.aape||{};window.aape.DisplayObjectContainer=DisplayObjectContainer;window.DisplayObjectContainer=DisplayObjectContainer;var prototype=DisplayObjectContainer.prototype=Object.create(PIXI.Container.prototype);prototype.constructor=DisplayObjectContainer;function DisplayObjectContainer(){PIXI.Container.call(this)}prototype.getChildByID=function(id){return this.getChildrenByID(id)[0]};prototype.getChildrenByID=function(id){match=match!==undefined?match:true;return this.getChildrenByPropertyAndValue("id",id,match)};prototype.getChildByName=function(name,recursive){return this.getChildrenByName(name,false,recursive)[0]};prototype.getChildrenByName=function(name,match,recursive){match=match!==undefined?match:true;return this.getChildrenByPropertyAndValue("name",name,match,recursive)};prototype.getChildrenByPropertyAndValue=function(property,value,match,recursive){match=match!==undefined?match:false;recursive=recursive!==undefined?recursive:true;var list=[];var children=this.children;for(var i=0;i<children.length;++i){var displayObject=children[i];var displayObjectChildren=displayObject.children;var displayObjectValue=displayObject[property];if(displayObjectValue){var hasMatch=match?displayObjectValue.match(value):displayObjectValue==value;if(hasMatch)list.push(displayObject)}if(displayObjectChildren.length>0&&displayObject.getChildrenByPropertyAndValue&&recursive)list=list.concat(displayObject.getChildrenByPropertyAndValue(property,value,match))}return list};Object.defineProperty(prototype,"stage",{get:function(){if(!this._stage){var parent=this.parent;while(parent!=null){parent=parent.parent;if(parent)this._stage=parent}}return this._stage}});Object.defineProperty(prototype,"renderer",{get:function(){return this.stage.renderer}})})(window);(function(window){window.aape=window.aape||{};window.aape.TextField=TextField;var prototype=TextField.prototype=Object.create(PIXI.Text.prototype);prototype.constructor=TextField;TextField.CENTER="center";TextField.RIGHT="right";TextField.LEFT="left";function TextField(text,style,margin){this.textStyle=style;this.margin=margin;PIXI.Text.call(this,text,style);this.setupText(text)}Object.defineProperty(prototype,"x",{get:function(){return this.position.x},set:function(value){this.position.x=value;this.cuePositionUpdate=true}});Object.defineProperty(prototype,"id",{get:function(){return this._id},set:function(value){this._id=value;this.cuePositionUpdate=true}});Object.defineProperty(prototype,"_text",{get:function(){return this.__text},set:function(value){this.__text=value;this.cuePositionUpdate=true}});prototype.setupText=function(text){this.text=text;this.setupComplete=true;this.cuePositionUpdate=true};prototype.updateTransformText=prototype.updateTransform;prototype.updateTransform=function(){this.updateTransformText();this.updateTextPosition()};prototype.updateTextPosition=function(){if(this.cuePositionUpdate===true){this.cuePositionUpdate=false;this.positionText()}};prototype.positionText=function(){if(this.setupComplete){var bounds=this.getBounds();switch(this.textStyle.align){case TextField.CENTER:this.alignTextToCenter(bounds);break;case TextField.RIGHT:this.alignTextToRight(bounds);break;default:this.alignTextToLeft(bounds);break}}};prototype.alignTextToCenter=function(bounds){var x=this.margin.x+(this.margin.width-bounds.width)*.5;this.position.x=x};prototype.alignTextToRight=function(bounds){var x=this.margin.x+this.margin.width-bounds.width;this.position.x=x};prototype.alignTextToLeft=function(bounds){this.position.x=this.margin.x}})(window);(function(window){window.aape=window.aape||{};window.aape.Parse=Parse;var prototype=Parse.prototype=Object.create(Object.prototype);prototype.constructor=Parse;function Parse(object){Parse.core={filter:function(callback,addProperty){addProperty=addProperty!==undefined?addProperty:false;var list=[];for(var property in object){var value=object[property];if(callback(property,value))list.push(addProperty?property:value)}return list},map:function(callback){var list=[];for(var property in object){var value=object[property];list.push(callback(property,value))}return list},every:function(callback){for(var property in object){var value=object[property];var result=callback(property,value);if(result)return true}return false},forEach:function(callback){for(var property in object){var value=object[property];callback(property,value)}},reduce:function(callback,result){for(var property in object){var value=object[property];result=callback(property,value,result)}return result},find:function(callback,result){for(var property in object){var value=object[property];if(callback(property,value,result)==true)result=property}return result},clone:function(){var parse=function(element,item){for(var property in element){var value=element[property];if(value instanceof Array)item[property]=parse(value,[]);else if(typeof value=="object")item[property]=parse(value,{});else item[property]=value}return item};var item=parse(object,{});return item}};return Parse.core}})(window);if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(predicate){"use strict";if(this==null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof predicate!=="function")throw new TypeError("predicate must be a function");var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0;i<length;i++){value=list[i];if(predicate.call(thisArg,value,i,list))return value}return undefined}})}(function(window){window.aape=window.aape||{};window.aape.Bezier=Bezier;var prototype=Bezier.prototype=Object.create(Object.prototype);prototype.constructor=Bezier;Bezier.p00={x:0,y:0};Bezier.p11={x:1,y:1};Bezier.linearTransition=[Bezier.p00,Bezier.p00,Bezier.p11,Bezier.p11];function Bezier(){}Bezier.getY=function(x,p0,p1,p2,p3){var t;if(x==p0.x){t=0}else if(x==p3.x){t=1}else{var a=-p0.x+3*p1.x-3*p2.x+p3.x;var b=3*p0.x-6*p1.x+3*p2.x;var c=-3*p0.x+3*p1.x;var d=p0.x-x;var tTemp=Bezier.solveCubic(a,b,c,d);if(tTemp==null)return null;t=tTemp}return Bezier.cubed(1-t)*p0.y+3*t*Bezier.squared(1-t)*p1.y+3*Bezier.squared(t)*(1-t)*p2.y+Bezier.cubed(t)*p3.y};Bezier.solveCubic=function(a,b,c,d){if(a==0)return Bezier.solveQuadratic(b,c,d);if(d==0)return 0;b/=a;c/=a;d/=a;var q=(3*c-Bezier.squared(b))/9;var r=(-27*d+b*(9*c-2*Bezier.squared(b)))/54;var disc=Bezier.cubed(q)+Bezier.squared(r);var term1=b/3;if(disc>0){var s=r+Math.sqrt(disc);s=s<0?-Bezier.cubicRoot(-s):Bezier.cubicRoot(s);var t=r-Math.sqrt(disc);t=t<0?-Bezier.cubicRoot(-t):Bezier.cubicRoot(t);var result=-term1+s+t;if(result>=0&&result<=1)return result}else if(disc==0){var r13=r<0?-Bezier.cubicRoot(-r):Bezier.cubicRoot(r);var result=-term1+2*r13;if(result>=0&&result<=1)return result;result=-(r13+term1);if(result>=0&&result<=1)return result}else{q=-q;var dum1=q*q*q;dum1=Math.acos(r/Math.sqrt(dum1));var r13=2*Math.sqrt(q);var result=-term1+r13*Math.cos(dum1/3);if(result>=0&&result<=1)return result;result=-term1+r13*Math.cos((dum1+2*Math.PI)/3);if(result>=0&&result<=1)return result;result=-term1+r13*Math.cos((dum1+4*Math.PI)/3);if(result>=0&&result<=1)return result}return null};Bezier.solveQuadratic=function(a,b,c){var result=(-b+Math.sqrt(Bezier.squared(b)-4*a*c))/(2*a);if(result>=0&&result<=1)return result;result=(-b-Math.sqrt(Bezier.squared(b)-4*a*c))/(2*a);if(result>=0&&result<=1)return result;return null};Bezier.squared=function(f){return f*f};Bezier.cubed=function(f){return f*f*f};Bezier.cubicRoot=function(f){return Math.pow(f,1/3)}})(window);(function(window){window.aape=window.aape||{};window.aape.Timeline=Timeline;var prototype=Timeline.prototype=Object.create(aape.DisplayObjectContainer.prototype);prototype.constructor=Timeline;Timeline.TIMELINE="timeline";Timeline.MOVIECLIP="movieclip";Timeline.SPRITE="sprite";Timeline.TEXTFIELD="textfield";Timeline.matrix=new PIXI.Matrix;function Timeline(setup){PIXI.Container.call(this);this.library=setup.library;this.elements=setup.elements;this.id=setup.id||"root";this.loop=setup.loop||true;this.timeScale=setup.timeScale!==undefined?setup.timeScale:1;this.onAnimationEnd=setup.onAnimationEnd||null;this.isPlaying=true;this.currentFrame=null;this.currentLabel=null;this.beginEndObject={};this.setFrame(0)}Object.defineProperty(prototype,"totalFrames",{get:function(){return this.template.totalFrames}});Object.defineProperty(prototype,"template",{get:function(){this._tempalte=this._tempalte!==undefined?this._tempalte:this.getTemplate(this.id);return this._tempalte}});Object.defineProperty(prototype,"labels",{get:function(){return this.template.labels}});prototype.getTemplate=function(id){return this.library[id]};Object.defineProperty(prototype,"timeScale",{get:function(){return this._timeScale},set:function(value){this._timeScale=value;var that=this;aape.Parse(this.layers).forEach(function(property,vo){var elements=vo.elements;elements.forEach(function(child){child.timeScale=that._timeScale})})}});prototype.updateTransformContainer=prototype.updateTransform;prototype.updateTransform=function(){this.updatePlayback();this.updateTransformContainer()};prototype.parse=function(id){var object=null;var template=this.getTemplate(id);switch(template.type){case Timeline.TIMELINE:object=this.getTimeline(id);break;case Timeline.MOVIECLIP:object=this.getMovieClip(id,template,this.elements);break;case Timeline.SPRITE:object=this.getSprite(id,template,this.elements);break;case Timeline.TEXTFIELD:object=this.getTextField(id,template);break}return object};prototype.updatePlayback=function(){var add=this.isPlaying?this.timeScale:0;this.setFrame(this.currentIndex+add)};prototype.gotoAndStop=function(frame){frame=this.inputToFrame(frame);this.setFrame(frame);this.stop()};prototype.gotoAndPlay=function(frame){frame=this.inputToFrame(frame);this.setFrame(frame);this.play()};prototype.play=function(){this.isPlaying=true};prototype.stop=function(){this.isPlaying=false};prototype.clone=function(){return this.getTimeline(this.id)};prototype.inputToFrame=function(frame){if(typeof frame=="number")return frame;else{this.currentLabel=frame;this.labelChanged=true;var index=this.labels[this.currentLabel];return index}};Object.defineProperty(prototype,"layers",{get:function(){this._layers=this._layers!==undefined?this._layers:{};return this._layers}});prototype.setLayer=function(id,vo){return this.layers[id]=vo};prototype.getLayer=function(id){if(this.layers[id]==undefined){this.layers[id]={elements:[],previousIndex:null,nextIndex:null,previousKeyframe:null,nextKeyframe:null}}return this.layers[id]};prototype.getLayerID=function(name,depth){var suffix=depth!==null?"#"+depth:"";var id=name+suffix;return id};prototype.getTimeline=function(id){var timeline=new aape.Timeline({library:this.library,elements:this.elements,timeScale:this.timeScale,id:id});return timeline};prototype.setFrame=function(currentIndex){this.currentIndex=currentIndex;this.nextFrame=this.getValidIndex(this.template,this.currentIndex);this.frameChanged=this.currentFrame===null||this.labelChanged||this.currentFrame.toFixed(8)!==this.nextFrame.toFixed(8);this.currentFrame=this.nextFrame;this.resolveLayers(this.template.layers);this.triggerLabelCallback(this.template,this.currentFrame);this.labelChanged=false};prototype.resolveLayers=function(layers){layers.forEach(function(layer,depth){var vo=this.resolveFrames(layer,depth);var id=this.getLayerID(layer.name,depth);this.setLayer(id,vo)}.bind(this))};prototype.resolveFrames=function(layer,depth){var layerID=this.getLayerID(layer.name,depth);var frames=layer.frames;var previousIndex=this.getPreviousIndex(frames,this.currentFrame);var previousKeyframe=frames[previousIndex];var hasAnimation=previousKeyframe.animation;var nextIndex=this.getNextIndex(frames,this.currentFrame);var nextKeyframe=hasAnimation?frames[nextIndex]:previousKeyframe;var previousElements=previousKeyframe.elements;var vo=this.getLayer(layerID);vo.previousIndex=previousIndex;vo.nextIndex=nextIndex;vo.previousKeyframe=previousKeyframe;vo.nextKeyframe=nextKeyframe;var elements=previousElements.map(function(element){return this.resolveElement(layerID,element)}.bind(this));this.removeMissing(layerID,elements);vo.elements=elements;return vo};prototype.resolveElement=function(layerID,element){var id=element.id;var layerVO=this.getLayer(layerID);var displayObject=this.getDisplayObject(layerVO,id);if(displayObject){if(this.frameChanged||this.frameChanged===undefined){this.addTransform(id,displayObject,layerVO);this.add(displayObject)}this.sync(displayObject,element,layerVO.previousIndex)}return displayObject};prototype.getDisplayObject=function(layerVO,id){var displayObject=null;displayObject=layerVO.elements.find(function(element){return element&&element.id==id});if(!displayObject){displayObject=this.parse(id);layerVO.elements.push(displayObject)}return displayObject};prototype.addTransform=function(id,displayObject,layerVO){var percent=this.getPercent(layerVO.previousIndex,layerVO.nextIndex,this.currentFrame);var transform=this.getTransform(layerVO.previousKeyframe,layerVO.nextKeyframe,id,percent);transform=this.translateMatrix(transform,displayObject);transform=this.translateVisible(transform);aape.Parse(transform).reduce(function(property,value,result){if(value!==undefined)result[property]=value;return result},displayObject);displayObject.name=displayObject.name?displayObject.name:displayObject.id},prototype.sync=function(displayObject,element,previousIndex){var list=[aape.MovieClip,aape.Timeline];if(this.getIsInstanceOf(displayObject,list)){var frame=null;if(element.loop!==undefined&&element.firstFrame!==undefined){if(element.loop=="single frame")frame=element.firstFrame;else if(element.loop=="play once"){var template=this.getTemplate(element.id);frame=Math.min(this.currentIndex-previousIndex,template.totalFrames-1)}else{var firstFrame=element.firstFrame||0;frame=firstFrame+(currentFrame-previousIndex)}if(displayObject.isPlaying)displayObject.setFrame(frame)}}},prototype.triggerLabelCallback=function(template,currentFrame){if(this.frameChanged&&this.currentLabel!==null&&this.onAnimationEnd!==null){var beginEndObject=this.getBeginEndObject(template,"labels",this.beginEndObject);var object=beginEndObject[this.currentLabel];if(object.end-1==Number(currentFrame.toFixed(2)))this.onAnimationEnd()}};prototype.add=function(displayObject){this.addChild(displayObject)},prototype.removeMissing=function(layerID,elements){var layerElements=this.getLayer(layerID).elements;if(layerElements){layerElements.forEach(function(child){element=elements.find(function(element){return element.id==child.id});if(element==undefined)this.removeChild(child)}.bind(this))}};prototype.getValidIndex=function(template,currentIndex){var frame=null;if(this.currentLabel===null){var totalFrames=template.totalFrames;if(totalFrames>1)frame=this.loop?currentIndex%totalFrames:currentIndex>=totalFrames-1?totalFrames-1:currentIndex;else frame=0;return frame}else{var beginEnd=this.getBeginEndObject(template,"labels");var range=beginEnd[this.currentLabel];var lastFrame=range.end-range.begin;frame=!this.loop&&currentIndex>=lastFrame?range.end-1:range.begin+currentIndex%lastFrame;return frame}};prototype.getIsInstanceOf=function(displayObject,list){var result=list.find(function(type){return displayObject instanceof type});return result};prototype.getMovieClip=function(id,template,elements){var json=this.getAtlasJSONWithID(elements,id);var textures=this.getTextures(elements,json,id);var animations=this.getBeginEndObject(template,"labels");var comments=this.getBeginEndObject(template,"comments");var movieClip=new aape.MovieClip(textures,animations,comments);movieClip.pivot=this.getDisplayObjectPivot(id,json);movieClip.play();return movieClip};prototype.getBeginEndObject=function(template,name,modObject){var object=template[name];if(object){var totalFrames=template.totalFrames;var item=aape.Parse(object).reduce(function(property,begin,result){result[property]=result[property]||{begin:begin,end:totalFrames};var compare=result[property];aape.Parse(object).forEach(function(property,value){compare.end=value<compare.end&&value>compare.begin?value:compare.end});return result},modObject||{});return item}else return null};prototype.getFrames=function(frames,id){var list=aape.Parse(frames).filter(this.nameIsID(id).bind(this));return list};prototype.getFilteredFrames=function(frames,id){var list=this.getFrames(frames,id);list.pop();return list};prototype.getTextures=function(elements,json,id){var frames=this.getFilteredFrames(json.frames,id);var baseTexture=this.getBaseTexture(elements,json.meta.image);var list=frames.map(function(item,index){var itemFrame=item.frame;var itemSpriteSourceSize=item.spriteSourceSize;var itemSourceSize=item.sourceSize;var frame=new PIXI.Rectangle(itemFrame.x,itemFrame.y,itemFrame.w,itemFrame.h);var orig=undefined;var trim=new PIXI.Rectangle(itemSpriteSourceSize.x,itemSpriteSourceSize.y,itemFrame.w,itemFrame.h);var texture=new PIXI.Texture(baseTexture,frame,orig,trim);return texture});return list};prototype.getBaseTexture=function(elements,image){var source=elements.find(function(element){var isImage=element instanceof Image;if(isImage){var path=element.src.split("/").slice(-1)[0].split("?")[0];var hasURL=path==image;return hasURL}});var baseTexture=new PIXI.BaseTexture(source);return baseTexture};prototype.getAtlasJSONWithID=function(elements,id){var json=elements.find(function(element){if(this.getIsValidAtlas(element)){var frames=element.frames;var hasID=aape.Parse(frames).every(this.nameIsID(id).bind(this));return hasID}else return false}.bind(this));return json};prototype.getIsValidAtlas=function(element){return element.frames&&element.meta};prototype.nameIsID=function(id){return function(property,value){var name=this.getFrameIDWithoutIndex(property);return name==id}};prototype.getFrameIDWithoutIndex=function(id){return id.slice(0,-4)};prototype.getSprite=function(id,template,elements){var json=this.getAtlasJSONWithID(elements,id);var texture=this.getTextures(elements,json,id)[0];var sprite=new aape.Sprite(texture);sprite.pivot=this.getDisplayObjectPivot(id,json);return sprite};prototype.getDisplayObjectPivot=function(id,json){var frames=this.getFrames(json.frames,id);var result=frames.reduce(function(result,frame){var size=frame.spriteSourceSize;result.x=size.x>result.x||result.x==null?size.x:result.x;result.y=size.y>result.y||result.y==null?size.y:result.y;return result},{x:null,y:null});return result};prototype.getTextField=function(item,template){var style=new PIXI.TextStyle;aape.Parse(template.style).forEach(function(property,value){style[property]=value}.bind(this));return new aape.TextField(template.text,style,template.margin)};prototype.getPercent=function(previous,next,currentFrame){var n0=currentFrame-previous;var n1=next-previous;var result=n1!==0?n0/n1:0;return result};prototype.getTransform=function(previous,next,id,percent){var animation=previous.animation;var previousItem=this.translateAlpha(this.getFrameTransform(previous,id));var nextItem=this.translateAlpha(this.getFrameTransform(next,id));var p=this.getBezierPoints(animation);var progress=aape.Bezier.getY(percent,p[0],p[1],p[2],p[3]);var transform=this.getTransformBetweenItems(previousItem,nextItem,progress);return transform};prototype.getTransformBetweenItems=function(previous,next,progress){var floatBetweenAandB=this.floatBetweenAandBAt;next=next!==undefined?next:previous;var parse=function(object,objectNext){var transform={};aape.Parse(object).reduce(function(property,value){if(typeof value=="number"){transform[property]=floatBetweenAandB(value,objectNext[property],progress)}else if(typeof value=="object")transform[property]=parse(value,objectNext[property]);else transform[property]=value});return transform};var transform=parse(previous,next);return transform};prototype.floatBetweenAandBAt=function(a,b,position){return a+position*(b-a)};prototype.quadraticBezier=function(t,p0,p1,p2,p3){return Math.pow(1-t,3)*p0+3*Math.pow(1-t,2)*t*p1+3*(1-t)*Math.pow(t,2)*p2+Math.pow(t,3)*p3};prototype.getBezierPoints=function(animation){var points=null;if(animation&&animation.length>0){points=animation.concat();points.unshift(aape.Bezier.p00);points.push(aape.Bezier.p11)}else points=aape.Bezier.linearTransition;return points};prototype.getFrameTransform=function(keyframe,id){var elements=keyframe.elements;var result=elements.find(function(element){return element.id==id});return result};prototype.translateVisible=function(object){object.visible=object.visible!==undefined?object.visible:true;return object};prototype.translateMatrix=function(transform,displayObject){var matrix=Timeline.matrix;var transformMatrix=transform.matrix;aape.Parse(transformMatrix).forEach(function(property,value){matrix[property]=transformMatrix[property]});matrix.c*=-1;displayObject.transform.setFromMatrix(matrix);return transform};prototype.translateAlpha=function(object){if(object)object.alpha=object.alpha!==undefined?object.alpha:1;return object};prototype.propertyToObjectValue=function(object,property,name,value){if(object[property]){var item=object[name]=object[name]||{};item[value]=object[property];delete object[property]}};prototype.getPreviousIndex=function(object,currentFrame){var result=aape.Parse(object).reduce(function(property,value,item){var frameIndex=Number(property);item=frameIndex>=item&&frameIndex<=currentFrame?frameIndex:item;return item}.bind(this),0);return result};prototype.getNextIndex=function(object,currentFrame){var biggestValue=aape.Parse(object).reduce(function(property,value,item){var frameIndex=Number(property);return frameIndex>item?frameIndex:item},0);var result=aape.Parse(object).reduce(function(property,value,item){var frameIndex=Number(property);item=frameIndex<=item&&frameIndex>=currentFrame?frameIndex:item;return item}.bind(this),biggestValue);return result}})(window);